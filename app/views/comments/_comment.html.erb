<div id="comment_<%= comment.id %>" class="p-2 mb-2 ">
  <strong><%= comment.account&.username || "Unknown User" %>:</strong>
    <%= comment.body %>
  <a href="#" class="text-primary small reply-link" data-comment-id="<%= comment.id %>">
    Reply
  </a>
  <% if comment.replies.any? %>
    <a href="#" class="text-primary small toggle-replies-link" data-comment-id="<%= comment.id %>">
      View All
    </a>
  <% end %>



  <div id="reply-form-<%= comment.id %>" class="mt-2" style="display:none;">
    <%= form_with(model: [comment.post, Comment.new], local: false, html: { class: "reply-form", data: { comment_id: comment.id } }) do |f| %>
      <%= f.hidden_field :parent_id, value: comment.id %>
      <%= f.text_field :body, placeholder: "Write a reply...", class: "form-control mb-2 reply-body" %>
      <%= f.submit "Reply", class: "btn btn-sm btn-primary" %>
    <% end %>
  </div>


        <% if comment.account == current_account %>
<%= button_to post_comment_path(comment.post, comment),
      method: :delete,
      data: { turbo_confirm: "Are you sure?" },
      class: "btn btn-sm btn-danger p-1 d-flex align-items-center justify-content-center" do %>
  <i class="fas fa-trash"></i>
<% end %>
<% end %>

  <div id="comments_<%= comment.id %>" class="replies-section mt-2" style="display:none;">
    <% comment.replies&.each do |reply| %>
      <div class="ms-4 mt-2 p-2 border-start">
         <%= render partial: "comments/comment", locals: { comment: reply } %>
      </div>
    <% end %>
  </div>


</div>

<script>
document.addEventListener("turbo:load", function() {

document.querySelectorAll(".reply-link").forEach(function(link) {
  link.addEventListener("click", function(event) {
    event.preventDefault();
    const commentId = this.getAttribute("data-comment-id");
    const replyForm = document.getElementById(`reply-form-${commentId}`);

    if ( replyForm.style.display === "none") {
      replyForm.style.display = "block"; 
    }else{
       
      }
  });
});


    document.querySelectorAll(".reply-form").forEach(function(form) {
      form.addEventListener("ajax:success", function() {
        const textField = this.querySelector(".reply-body");
        if (textField) {
          textField.value = ""; 
        }
      });
    });

  });

document.querySelectorAll(".toggle-replies-link").forEach(function(link) {
  link.addEventListener("click", function(event) {
    event.preventDefault();
    const commentId = this.getAttribute("data-comment-id");
    const repliesSection = document.getElementById(`comments_${commentId}`);


    if (repliesSection.style.display === "" || repliesSection.style.display === "none") {
      repliesSection.style.display = "block";
      this.textContent = "Hide Replies";
    } else {
      repliesSection.style.display = "none";
      this.textContent = "View All";
    }
  });
});

</script>
